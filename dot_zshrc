eval "$(/opt/homebrew/bin/brew shellenv)"
eval "$(starship init zsh)"
eval "$(direnv hook zsh)"

setopt HIST_IGNORE_ALL_DUPS  # ignore duplicate histories
setopt interactivecomments   # allow comments in zsh command

ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# zsh plugins
zinit light zsh-users/zsh-completions          # completion subcommands and options
zinit light zsh-users/zsh-autosuggestions      # show possible commands based on history
zinit light zsh-users/zsh-syntax-highlighting  # syntax highlighing for zsh

# zsh completion
FPATH="/opt/homebrew/share/zsh/site-functions:${FPATH}"
FPATH="${HOME}/.zfunc:${FPATH}"
autoload -Uz compinit && compinit

# zstyle
zstyle ':completion:*' menu select

source "/opt/homebrew/share/google-cloud-sdk/path.zsh.inc"
source "/opt/homebrew/share/google-cloud-sdk/completion.zsh.inc"

# tmux autostart script
if [[ ! -n $TMUX ]] && [[ $TERM_PROGRAM != "vscode" ]]; then
	ID="`tmux list-sessions`"
    if [[ -z "$ID" ]]; then
        tmux new-session
    fi
    ID="$ID\nCreate New Session"
    ID="`echo $ID | fzf | cut -d: -f1`"
    if [[ "$ID" = "Create New Session" ]]; then
        tmux new-session
    elif [[ -n "$ID" ]]; then
        tmux attach-session -t "$ID"
    else
        :
    fi
fi

function togif() {
    ffmpeg -i $1 -r 10 -vf scale=320:-1 "$(basename $1).gif"
}

function tohevc() {
    ffmpeg -i $1 -codec "hevc_videotoolbox" "$(basename $1).mp4"
}

function gotestcov() {
    TMPDIR=$(mktemp -d)
    PROFILE_OUT="${TMPDIR}/cover.out"
    HTML_OUT="${TMPDIR}/cover.html"
    chmod +w ${TMPDIR}
    go test -shuffle on -race -v -cover -coverprofile=${PROFILE_OUT} -p 1 $1 \
    && go tool cover -html=${PROFILE_OUT} -o ${HTML_OUT} \
    && open ${HTML_OUT}
}

# alias
alias ls='lsd'
alias cat='bat'
alias fd='fd -I --no-ignore-vcs'
alias matumoto='echo "Hello, I am matumoto!"'
alias mv='mv -v'
#alias rm='rm -v'
alias gitroot='cd `git rev-parse --show-superproject-working-tree --show-toplevel | head -1`'
alias sed="gsed"


# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/opt/homebrew/Caskroom/miniconda/base/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/opt/homebrew/Caskroom/miniconda/base/etc/profile.d/conda.sh" ]; then
        . "/opt/homebrew/Caskroom/miniconda/base/etc/profile.d/conda.sh"
    else
        export PATH="/opt/homebrew/Caskroom/miniconda/base/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<


# bun completions
[ -s "/Users/earlgray/.bun/_bun" ] && source "/Users/earlgray/.bun/_bun"
